#!/bin/bash

echo "ğŸš€ SkyeNetV 2.4.7 - DEPLOYMENT CHECKLIST"
echo "========================================="
echo ""

# Check if we're in the right directory
if [ ! -f "target/SkyeNetV-2.4.7.jar" ]; then
    echo "âŒ ERROR: SkyeNetV-2.4.7.jar not found!"
    echo "   Make sure you're in the SkyeNetV project directory"
    echo "   and the plugin has been compiled."
    exit 1
fi

echo "âœ… Plugin JAR found: $(ls -la target/SkyeNetV-2.4.7.jar | awk '{print $5}') bytes"
echo ""

echo "ğŸ“‹ PRE-DEPLOYMENT CHECKLIST:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "â–¡ Velocity server is stopped"
echo "â–¡ Current plugin backed up"
echo "â–¡ config.yml reviewed for global_chat section"
echo "â–¡ Discord bot token configured"
echo "â–¡ LuckPerms is installed and working"
echo ""

echo "ğŸ”§ DEPLOYMENT STEPS:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1. Stop Velocity server:"
echo "   systemctl stop velocity"
echo ""
echo "2. Backup current plugin:"
echo "   cp plugins/SkyeNetV-*.jar plugins/SkyeNetV-backup.jar"
echo ""
echo "3. Deploy new plugin:"
echo "   cp $(pwd)/target/SkyeNetV-2.4.7.jar /path/to/velocity/plugins/"
echo ""
echo "4. Start server:"
echo "   systemctl start velocity"
echo ""

echo "ğŸ§ª POST-DEPLOYMENT TESTING:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "â–¡ Player joins server - no errors in console"
echo "â–¡ Player uses /gc to enable global chat"
echo "â–¡ Join message shows: [+] [PREFIX] PlayerName joined global chat"
echo "â–¡ Player sends message - appears ONLY ONCE in global format"
echo "â–¡ Player uses /gc to disable global chat"
echo "â–¡ Leave message shows: [-] [PREFIX] PlayerName left global chat"
echo "â–¡ Local chat still works when global chat disabled"
echo "â–¡ /lc command works for local bypass"
echo "â–¡ Discord integration working (if configured)"
echo ""

echo "ğŸ¯ CRITICAL TEST - DUPLICATION FIX:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1. Player enables global chat: /gc"
echo "2. Player sends: hello world"
echo "3. âœ… EXPECTED: Message appears ONCE in global format"
echo "4. âŒ OLD BUG: Message would appear twice (fixed in 2.4.7!)"
echo ""

echo "ğŸ“ NEW FEATURES IN 2.4.7:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "â€¢ âœ… Fixed global chat duplication (CRITICAL FIX)"
echo "â€¢ âœ… New join/leave message format with [+]/[-] brackets"
echo "â€¢ âœ… Improved event handling and flow control"
echo "â€¢ âœ… Enhanced Discord integration reliability"
echo "â€¢ âœ… Configurable global chat message formats"
echo ""

echo "ğŸ†˜ ROLLBACK PROCEDURE (if needed):"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1. Stop server: systemctl stop velocity"
echo "2. Restore backup: cp plugins/SkyeNetV-backup.jar plugins/SkyeNetV.jar"
echo "3. Start server: systemctl start velocity"
echo ""

echo "ğŸ“ SUPPORT:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "â€¢ Version 2.4.7 fixes the major duplication issue"
echo "â€¢ Check logs for any errors during startup"
echo "â€¢ Test global chat functionality thoroughly"
echo "â€¢ Report any issues for quick resolution"
echo ""

echo "ğŸ‰ SkyeNetV 2.4.7 - Ready for Production Deployment!"
echo "This version FINALLY resolves the chat duplication issue!"
